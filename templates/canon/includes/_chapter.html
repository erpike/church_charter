{% from "canon/includes/_edit_controls.html" import edit_controls %}
{% from "canon/includes/_item.html" import canon_item %}

{% macro canon_chapter(chapter, is_authenticated) %}
<div class="d-flex justify-content-between align-items-center mb-1">
    <h5 class="mb-0">
        {% if is_authenticated %}
        <span class="drag-handle edit-mode-only" style="cursor: move; margin-right: 5px; display: none;">☰</span>
        {% endif %}
        {{ chapter.title }}
    </h5>
    {% if is_authenticated %}
        {{ edit_controls('главу', chapter.id, url_for('canon.edit_chapter', chapter_id=chapter.id), url_for('canon.delete_chapter', chapter_id=chapter.id)) }}
    {% endif %}
</div>
{% if chapter.items %}
    <div class="mt-1 items-container" data-chapter-id="{{ chapter.id }}">
        {% for item in chapter.items|sort(attribute='position') %}
            {{ canon_item(item, is_authenticated) }}
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info py-1">
        Немає елементів у цій главі.
    </div>
{% endif %}
{% if is_authenticated %}
    <div class="mt-1 edit-mode-only" style="display: none;">
        <a href="{{ url_for('canon.create_item', chapter_id=chapter.id) }}" class="btn btn-sm btn-primary">
            Додати елемент
        </a>
    </div>
{% endif %}
{% endmacro %} 